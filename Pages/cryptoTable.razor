@page "/cryptocurrencies"

<PageTitle>Cryptocurrencies</PageTitle>

@using CIP.Website.Data
@using CIP.Website.Data.Interfaces;
@using CIP.Website.Data.Models;
@using CIP.Website.Data.Services;
@using MudBlazor;
@inject ICryptocurrency cryptocurrency

<style>
    .row-on-hover:hover {
        cursor: pointer;
        background-color: #DCDCDC;
    }

    .page-background {
        
        width: 100%;
        height: 100%;
        padding-left: 0;
        padding-right: 0;
    }
</style>

<div class="page-background">
    <div class="card-header">
        <div class="row">
            <h2> The top 100 cryptocurrencies by market cap </h2>
        </div>
        <div class="row">
            <p>
                Disclosure: All data displayed here comes from Coingecko.
            </p>
        </div>
    </div>
    <div class="card-body">
        <div class="row">
            <table class="table table-dark">
                <thead>
                    <tr>
                        <th scope="col">Rank</th>
                        <th scope="col">Cryptocurrency</th>
                        <th scope="col">Coin valuation</th>
                        <th scope="col">Market cap</th>
                    </tr>
                </thead>
                <tbody>
                    @if(!_cryptocurrencies.Any() && _justSearched)
                    {
                        <tr>
                            <td colspan="12">
                                <div class="alert alert-danger" role="alert">
                                    Something went wrong...please refresh the page or try again later!
                                </div>
                            </td>
                        </tr>
                    }
                    @foreach(Cryptocurrency cryptocurrency in _cryptocurrencies)
                    {
                        <tr class="row-on-hover">
                            <td>@cryptocurrency.Rank</td>
                            <td>@cryptocurrency.Name</td>
                            <td>@cryptocurrency.USDValuation</td>
                            <td>@cryptocurrency.MarketCap</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>



@code {
    private bool _fixedHeader = true;
    private bool _justSearched = false;
    private IEnumerable<Cryptocurrency> _cryptocurrencies = Enumerable.Empty<Cryptocurrency>();

    protected override async Task OnInitializedAsync()
    {
        _cryptocurrencies = await cryptocurrency.Get();
        _justSearched = true;
    }
}
